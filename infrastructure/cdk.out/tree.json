{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.238.0"},"children":{"MailhubWorkerStack":{"id":"MailhubWorkerStack","path":"MailhubWorkerStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.238.0"},"children":{"EmailQueue":{"id":"EmailQueue","path":"MailhubWorkerStack/EmailQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueueBase","version":"2.238.0"}},"EmailWorker":{"id":"EmailWorker","path":"MailhubWorkerStack/EmailWorker","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.238.0"},"children":{"ServiceRole":{"id":"ServiceRole","path":"MailhubWorkerStack/EmailWorker/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/EmailWorker/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MailhubWorkerStack/EmailWorker/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/EmailWorker/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject","s3:GetObjectVersion"],"Effect":"Allow","Resource":"arn:aws:s3:::private-mailhub-bucket/*"},{"Action":["ses:SendEmail","ses:SendRawEmail"],"Effect":"Allow","Resource":"*"},{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ReceiveMessage"],"Effect":"Allow","Resource":"arn:aws:sqs:us-east-1:584669670737:Private-MailHub-incoming-queue"}],"Version":"2012-10-17"},"policyName":"EmailWorkerServiceRoleDefaultPolicy0316A11C","roles":[{"Ref":"EmailWorkerServiceRoleB01A4F9E"}]}}}}}}},"Code":{"id":"Code","path":"MailhubWorkerStack/EmailWorker/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.238.0"},"children":{"Stage":{"id":"Stage","path":"MailhubWorkerStack/EmailWorker/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.238.0"}},"AssetBucket":{"id":"AssetBucket","path":"MailhubWorkerStack/EmailWorker/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.238.0"}}}},"Resource":{"id":"Resource","path":"MailhubWorkerStack/EmailWorker/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-584669670737-us-east-1","s3Key":"a5bbaa22c8ed0bc0fab8b3ec634879028981e79719b28a57034d28d34cc4c3db.zip"},"environment":{"variables":{"NODE_ENV":"production","DATABASE_HOST":"","DATABASE_PORT":"3306","DATABASE_NAME":"","DATABASE_USERNAME":"","DATABASE_PASSWORD":"","REDIS_HOST":"","REDIS_PORT":"6379","REDIS_TTL":"3600","AWS_S3_EMAIL_BUCKET":"private-mailhub-bucket","AWS_SES_FROM_EMAIL":"","APP_NAME":"Mailhub","APP_DOMAIN":"private-mailhub.com","ENCRYPTION_KEY":""}},"functionName":"mailhub-email-worker","handler":"lambda/sqs-worker.handler","memorySize":512,"role":{"Fn::GetAtt":["EmailWorkerServiceRoleB01A4F9E","Arn"]},"runtime":"nodejs18.x","timeout":60}}},"LogRetention":{"id":"LogRetention","path":"MailhubWorkerStack/EmailWorker/LogRetention","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/EmailWorker/LogRetention/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.238.0"}}}},"LogGroup":{"id":"LogGroup","path":"MailhubWorkerStack/EmailWorker/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.238.0"}},"SqsEventSource:MailhubWorkerStackEmailQueueBD89A45A":{"id":"SqsEventSource:MailhubWorkerStackEmailQueueBD89A45A","path":"MailhubWorkerStack/EmailWorker/SqsEventSource:MailhubWorkerStackEmailQueueBD89A45A","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.EventSourceMapping","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/EmailWorker/SqsEventSource:MailhubWorkerStackEmailQueueBD89A45A/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnEventSourceMapping","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::EventSourceMapping","aws:cdk:cloudformation:props":{"batchSize":10,"enabled":true,"eventSourceArn":"arn:aws:sqs:us-east-1:584669670737:Private-MailHub-incoming-queue","functionName":{"Ref":"EmailWorker9F0FF8B3"},"functionResponseTypes":["ReportBatchItemFailures"],"maximumBatchingWindowInSeconds":0}}}}}}},"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a":{"id":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","constructInfo":{"fqn":"constructs.Construct","version":"10.4.5"},"children":{"Code":{"id":"Code","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.238.0"},"children":{"Stage":{"id":"Stage","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.238.0"}},"AssetBucket":{"id":"AssetBucket","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.238.0"}}}},"ServiceRole":{"id":"ServiceRole","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:DeleteRetentionPolicy","logs:PutRetentionPolicy"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB","roles":[{"Ref":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"}]}}}}}}},"Resource":{"id":"Resource","path":"MailhubWorkerStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.238.0"}}}},"EmailWorkerErrorAlarm":{"id":"EmailWorkerErrorAlarm","path":"MailhubWorkerStack/EmailWorkerErrorAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/EmailWorkerErrorAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Alert when Lambda function has errors","alarmName":"mailhub-email-worker-errors","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"EmailWorker9F0FF8B3"}}],"evaluationPeriods":1,"metricName":"Errors","namespace":"AWS/Lambda","period":300,"statistic":"Sum","threshold":5}}}}},"EmailWorkerDurationAlarm":{"id":"EmailWorkerDurationAlarm","path":"MailhubWorkerStack/EmailWorkerDurationAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"MailhubWorkerStack/EmailWorkerDurationAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Alert when Lambda duration is close to timeout","alarmName":"mailhub-email-worker-duration","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"EmailWorker9F0FF8B3"}}],"evaluationPeriods":2,"metricName":"Duration","namespace":"AWS/Lambda","period":300,"statistic":"Average","threshold":50000}}}}},"LambdaFunctionName":{"id":"LambdaFunctionName","path":"MailhubWorkerStack/LambdaFunctionName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"LambdaFunctionArn":{"id":"LambdaFunctionArn","path":"MailhubWorkerStack/LambdaFunctionArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"CloudWatchLogGroup":{"id":"CloudWatchLogGroup","path":"MailhubWorkerStack/CloudWatchLogGroup","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"MailhubWorkerStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.5"},"children":{"Default":{"id":"Default","path":"MailhubWorkerStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.238.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"MailhubWorkerStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.238.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"MailhubWorkerStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.238.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.5"}}}}}